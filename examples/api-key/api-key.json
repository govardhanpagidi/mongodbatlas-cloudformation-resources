{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "This templates Creates one API key for the specified MongoDB Atlas organization. An organization API key grants programmatic access to an organization.",
  "Parameters": {
    "OrgId": {
      "Type": "String",
      "Description": "MongoDB Atlas Organization ID",
      "Default":"63350255419cf25e3d511c95"
    },
    "ProjectId": {
      "Type": "String",
      "Description": "MongoDB Atlas Project ID",
      "Default": "64d5087aabbb8940f6e4a8d4"
    },
    "ProjectId2": {
      "Type": "String",
      "Description": "MongoDB Atlas Project ID",
      "Default": "64d5087dd22872333d099c6e"
    },
    "Profile": {
      "Type": "String",
      "Description": "Your MongoDB Atlas Profile Name created in secret manager",
      "Default": "default"
    },
    "OrgRoles": {
      "Type": "List<String>",
      "Description": "Role names",
      "Default": "ORG_TEAM_MEMBERS_ADMIN,ORG_GROUP_CREATOR",
      "ConstraintDescription": "Comma Seperated String with Role names"
    },
    "ProjectRoles": {
      "Type": "List<String>",
      "Description": "Role names",
      "Default": "GROUP_READ_ONLY,GROUP_SEARCH_INDEX_EDITOR,GROUP_CLUSTER_MANAGER",
      "ConstraintDescription": "Comma Seperated String with Role names"
    },
    "Project2Roles": {
      "Type": "List<String>",
      "Description": "Role names",
      "Default": "GROUP_READ_ONLY",
      "ConstraintDescription": "Comma Seperated String with Role names"
    },
    "Description": {
      "Type": "String",
      "Description": "Purpose or explanation provided when someone created this organization API key.",
      "Default": "for cfn testing..."
    }
  },
  "Mappings": {},
  "Resources": {
    "APIKey": {
      "Type": "MongoDB::Atlas::APIKey",
      "Properties": {
        "OrgId": {
          "Ref": "OrgId"
        },
        "Roles": { "Ref": "OrgRoles" },
        "Description": {"Ref": "Description"},
        "Profile": {
          "Ref": "Profile"
        },
        "ProjectAssignments": [
          {
            "ProjectId": {"Ref": "ProjectId"},
            "Roles": {"Ref": "ProjectRoles"}
          },
          {
            "ProjectId": {"Ref": "ProjectId2"},
            "Roles": {"Ref": "Project2Roles"}
          }
        ]
      }
    }
  },
  "Outputs": {
    "APIKeyID": {
      "Value": {
        "Fn::GetAtt": [
          "APIKey",
          "APIUserId"
        ]
      }
    },
    "APIKeyPublicKey": {
      "Value": {
        "Fn::GetAtt": [
          "APIKey",
          "PublicKey"
        ]
      }
    }
  }
}
